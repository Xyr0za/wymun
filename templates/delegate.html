<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MUN Delegate Input</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
    </style>
</head>
<body class="bg-[#F5F5F7] min-h-screen flex items-center justify-center p-4">

    <div class="bg-white p-8 md:p-10 rounded-xl shadow-2xl w-full max-w-lg border-t-4 border-[#0B2447]">
        <h1 class="text-3xl font-bold text-[#0B2447] mb-2 text-center">
            Delegate Submission Portal
        </h1>

        <div class="text-lg font-bold text-gray-700 mb-6 text-center">
            Logged in as: <span id="delegate-id-display" class="text-[#478E99]">{{ delegate_id }}</span>
            <a href="{{ url_for('logout') }}" class="text-xs text-red-600 hover:text-red-800 ml-3 font-normal align-top">Logout</a>
        </div>

        <div class="mb-8 border p-4 rounded-lg bg-indigo-50 border-indigo-200">
            <h2 class="text-xl font-bold text-indigo-700 mb-3">Draft Resolution</h2>
            <input type="text" id="resolution-title" placeholder="Resolution Title / Number (e.g., DR 1.1)"
                class="w-full p-2 border border-gray-300 rounded-lg focus:border-indigo-500 mb-3">
            <textarea id="resolution-content" rows="4"
                class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-indigo-500 resize-none mb-4"
                placeholder="Enter operative clauses and content..."></textarea>
            <button onclick="sendResolution()"
                class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-2 rounded-lg transition duration-200">
                Submit Resolution
            </button>
        </div>

        <div class="mb-8 border p-4 rounded-lg bg-orange-50 border-orange-200">
            <h2 class="text-xl font-bold text-orange-700 mb-3">Amendment</h2>
            <input type="text" id="amendment-target" placeholder="Target Resolution (e.g., DR 1.1, Clause 3)"
                class="w-full p-2 border border-gray-300 rounded-lg focus:border-orange-500 mb-3">
            <textarea id="amendment-text" rows="2"
                class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-orange-500 resize-none mb-4"
                placeholder="Details of the amendment (e.g., Strike 'may', insert 'shall')..."></textarea>
            <button onclick="sendAmendment()"
                class="w-full bg-orange-600 hover:bg-orange-700 text-white font-semibold py-2 rounded-lg transition duration-200">
                Submit Amendment
            </button>
        </div>

        <div class="border-t pt-6 mt-6 border-gray-200">
            <h2 class="text-xl font-bold text-gray-700 mb-4 text-center">Cast a Formal Vote</h2>
            <p class="text-sm text-center text-red-500 mb-4 font-medium">Use only when instructed by the Chair.</p>
            <div class="flex space-x-4">
                <button onclick="sendVote('yay')"
                    class="flex-1 bg-green-600 hover:bg-green-700 text-white font-extrabold py-4 rounded-xl transition duration-200 shadow-lg text-xl">
                    ✅ YAY (In Favour)
                </button>
                <button onclick="sendVote('nay')"
                    class="flex-1 bg-red-600 hover:bg-red-700 text-white font-extrabold py-4 rounded-xl transition duration-200 shadow-lg text-xl">
                    ❌ NAY (Against)
                </button>
            </div>
        </div>
        <div id="feedback-message" class="mt-4 text-center text-sm font-medium h-5"></div>

    </div>

    <script>
        const socket = io();
        const delegateId = document.getElementById('delegate-id-display').textContent.trim();
        const feedbackElement = document.getElementById('feedback-message');

        // --- New Function: Send Resolution ---
        function sendResolution() {
            const title = document.getElementById('resolution-title').value.trim();
            const content = document.getElementById('resolution-content').value.trim();

            if (title === "" || content === "") {
                setFeedback("Resolution title and content are required.", 'red');
                return;
            }

            socket.emit('mun_submission', {
                delegate_id: delegateId,
                type: 'resolution',
                title: title,
                content: content
            });

            setFeedback(`Resolution "${title}" submitted!`, 'green');
            document.getElementById('resolution-title').value = '';
            document.getElementById('resolution-content').value = '';
        }

        // --- New Function: Send Amendment ---
        function sendAmendment() {
            const target = document.getElementById('amendment-target').value.trim();
            const text = document.getElementById('amendment-text').value.trim();

            if (target === "" || text === "") {
                setFeedback("Amendment target and text are required.", 'red');
                return;
            }

            socket.emit('mun_submission', {
                delegate_id: delegateId,
                type: 'amendment',
                target: target,
                text: text
            });

            setFeedback(`Amendment for ${target} submitted!`, 'green');
            document.getElementById('amendment-target').value = '';
            document.getElementById('amendment-text').value = '';
        }

        // --- Retained Function: Send Vote ---
        function sendVote(voteType) {
            socket.emit('mun_submission', {
                delegate_id: delegateId,
                type: 'vote',
                vote: voteType // 'yay' or 'nay'
            });

            const voteText = voteType === 'yay' ? 'YAY' : 'NAY';
            setFeedback(`Formal Vote "${voteText}" recorded!`, 'green');
        }

        // --- Helper function for cleaner feedback ---
        function setFeedback(message, color) {
            feedbackElement.textContent = message;
            feedbackElement.classList.remove('text-green-600', 'text-red-600');
            feedbackElement.classList.add(color === 'green' ? 'text-green-600' : 'text-red-600');

            setTimeout(() => {
                feedbackElement.textContent = '';
            }, 3000);
        }

    </script>
</body>
</html>